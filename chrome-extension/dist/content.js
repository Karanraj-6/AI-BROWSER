const waitForDocumentReady=async()=>{document.readyState==="complete"||document.readyState==="interactive"||await new Promise(e=>{const n=()=>{(document.readyState==="complete"||document.readyState==="interactive")&&(document.removeEventListener("readystatechange",n),e())};document.addEventListener("readystatechange",n)})},waitForElement=async(e,n=15e3)=>{await waitForDocumentReady();const c=()=>document.querySelector(e),t=c();return t||new Promise(m=>{let l=!1,r=null,a=null,s=null;const f=()=>{r&&(r.disconnect(),r=null),a!==null&&(clearInterval(a),a=null),s!==null&&(clearTimeout(s),s=null)},i=o=>{l||(l=!0,f(),m(o))},u=()=>{const o=c();return o?(i(o),!0):!1};r=new MutationObserver(()=>{u()});const d=document.body??document.documentElement;d&&r.observe(d,{childList:!0,subtree:!0}),a=window.setInterval(()=>{u()},200),s=window.setTimeout(()=>{i(null)},n),u()})},handleAction=async action=>{switch(action.type){case"CLICK":{const e=await waitForElement(action.selector);if(!e)return{success:!1,error:"selector-not-found"};try{e.scrollIntoView({block:"center",inline:"center",behavior:"instant"})}catch{}return e.click(),{success:!0}}case"FILL":{const e=await waitForElement(action.selector);return e?"value"in e?(e.focus(),e.value=action.value,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),{success:!0}):{success:!1,error:"unsupported-element"}:{success:!1,error:"selector-not-found"}}case"EVALUATE_SCRIPT":{const result=eval(action.code);return{success:!0,result}}default:return{success:!1,error:`unsupported-action:${action==null?void 0:action.type}`}}};chrome.runtime.onMessage.addListener((e,n,c)=>{if((e==null?void 0:e.type)==="CONTENT_ACTION")return Promise.resolve(handleAction(e.payload)).then(t=>c(t)).catch(t=>c({success:!1,error:(t==null?void 0:t.message)??String(t)})),!0});
